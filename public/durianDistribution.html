<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>		
	<script src="contract.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <title>Durian Distribution</title>

    <style>
    body {
		background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url("https://www.myfreetextures.com/wp-content/uploads/2014/11/another-flowing-blue-abstract-texture.jpg");
		background-repeat: no-repeat;
		background-attachment: fixed;
		background-size: cover;
		margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
    }
    header {
        /* background-color: #146C94; */
        color: #fff;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
    }
    nav ul {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
    }
    nav li {
        margin: 0 10px;
    }
    nav a {
        color: #fff;
        text-decoration: none;
        padding: 10px;
    }
	nav a:hover {
		background-color: #fff;
		color: #146C94;
		border-radius: 5px;
	}
	nav a {
		transition: all 0.3s ease 0s;
	}
	main {
		padding: 10px;
		width: 80vw;
		margin-left: auto;
		margin-right: auto;
	}

    </style>
  </head>
  <body>
    <header>
      <h1 style="margin-left: 2vw;">DurianChain</h1>
      <nav>
        <ul>
          <li><a href="./homepage.html">Home</a></li>
          <li><a href="./durianInitializer.html">Durian Initializer</a></li>
		  <li><a href="./durianRequest.html">Durian Request</a></li>

          <li><a href="./durianDistribution.html">Durian Distribution</a></li>
          <li><a href="./durianTracking.html">Durian Tracking</a></li>
		  <li><a href="#" onclick="logout()">Logout</a></li>
        </ul>
      </nav>
    </header>

	<main>

	</main>

    <script>
        //3-read data from smart contract
        const readfromContract = async () => {
			getDurianStock();
        }
        
		// transfer onclick
		$("#transferBtn").click(function(){
			var durianID = $("#durianID").val();
			var destinationID = $("#destinationID").val();

			window.contract.methods.sendDurian(durianID, destinationID).call();
			$("#durianID").val("");
			$("#destinationID").val("");
		});

		$("#getBtn").click(function() {
			var durian = window.contract.methods.DurianIn(account, 0).call();
			$("#test").innerHTML = durian.durianInfo.durianID;
		});

		document.getElementById("getBtn").addEventListener("click", function(){
			event.preventDefault();
	});

		const registerTree = async () => {
          const species= document.getElementById("regTree").value;
          //const data = await window.contract.methods.register().call();
				  await window.contract.methods.registerTree(species).send({from: account});
				}

		const registerDurian = async () => {
          const treeid = document.getElementById("DurianTreeID").value;
          const weight = document.getElementById("DurianWeight").value;
          const timeharvest = document.getElementById("DuriantimeHarvest").value;
          const worker = document.getElementById("DurianworkerHarvest").value;
          const desc = document.getElementById("DurianDescription").value;
          //const data = await window.contract.methods.register().call();
				  await window.contract.methods.registerDurian(treeid,weight,timeharvest,worker,desc).send({from: account});
				}

		// Array of data to display in the accordion
		const accordionData = [
		{ title: "Accordion 1", content: "Content for Accordion 1" },
		// Add more items to the array as needed
		];

		// push data to accordiondata array
		const getDurianStock = async () => {
			const species = ["Black Thorn", "D101", "D24","Musang King","Red Prawn", "XO"]
			var durianStock = [];
			for (var i = 0; i < species.length; i++) {
				var durianCount = await window.contract.methods.currentDurianCountOnSpecies(account, species[i]).call();
				for (var j = 0; j < durianCount; j++) {
					var durian = await window.contract.methods.DurianIn(account, species[i], j).call();
					durianStock.push(durian);
				}
			}
			durianStock.forEach((durian, index) => {
				const accordionItem = {
				title: durian.durianInfo.durianID,
				content: `
					<p>Species: ${durian.durianBelongTree.treeSpecies}</p>
					<p>Weight: ${durian.durianInfo.durianWeight_g}</p>
					<p>Description: ${durian.durianInfo.description}</p>
					<p>Harvested by: ${durian.harvestInfo.workerHarvest}</p>
					<p>Harvested at: ${durian.harvestInfo.timeHarvest}</p>
				`
				};
				accordionData.push(accordionItem);
			});
		};

		readfromContract();

		// Get a reference to the accordion container
		const accordion = document.querySelector("#accordion");
		
		// Loop through the data and generate the HTML markup for each accordion element
		accordionData.forEach((item, index) => {
			// Create the header element
			const header = document.createElement("div");
			header.classList.add("accordion-header");
			header.innerHTML = `
				<button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-${index}" aria-expanded="false" aria-controls="collapse-${index}">
				${item.title}
				</button>
			`;
			
			// Create the body element
			const body = document.createElement("div");
			body.classList.add("accordion-body", "collapse");
			body.id = `collapse-${index}`;
			body.innerHTML = `
				<div class="accordion-content">
				${item.content}
				</div>
			`;
			
			// Append the header and body elements to the accordion container
			accordion.appendChild(header);
			accordion.appendChild(body);
		});

		// add click event listener to accordion-button class then toggle the show class for the accordion-body
		const accordionButton = document.querySelectorAll(".accordion-button");
		accordionButton.forEach((button) => {
			button.addEventListener("click", () => {
				body = button.parentElement.nextElementSibling;
				// console.log(body)
				body.classList.toggle("collapse");
			});
		});

		const logout = async () => {
        await window.contract.methods.logout().send({ from: account })
        .then((logout) => {
          alert('You have successfully logout from account');
          window.location.href="/registration.html";
         });
      };
    </script>
  </body>
</html>
